---
title: 'Linking Stormwater Control Performance to Stream Ecosystem Outcomes: Incorporating Performance Metrics into Effective Imperviousness'
subtitle: 'Supplementary material S3: Stormwater control measure spatial database'
author: 'Christopher J. Walsh, Matthew J. Burns, Tim D. Fletcher, Darren G. Bos, Peter Poelsma, Joshphar Kunapo and Sam J. Imberger'
date: 'School of Ecosystem and Forest Sciences, The University of Melbourne, 500 Yarra Boulevard, Burnley Victoria 3121, Australia '
output:
  word_document:
    reference_docx: myStyle_double.docx
csl: water-resources-research.csl
bibliography: references.bib
---
### Equations and Figures
=======

### Figure captions  

Fig. 1.  Examples of stream ecosystem response variables as a function of effective imperviousness (EI) as piecewise regressions (solid black line with 95% confidence intervals in the grey polygon as derived by Walsh et al., 2005a), compared to a linear regression against log$_{10}$(EI + 0.001), solid red line with dotted 95% confidence limits. a) Median filterable reactive phosphorus (FRP) concentrations and b) SIGNAL score (a biotic index). Five overlapping points in a) are shown by slight jittering.

Fig. 2.  The 11 streamflow-gauging sites considered in this paper and their catchments, coloured by their status as control, experimental or reference. The 7 primary catchments of the original experiment are italicized, and the site and catchment of flow gauges in two stormwater pipes (Wicks and Heath) are shown. Impervious areas in each catchment are shaded by their connection to the stormwater drainage system. (Impervious areas outside catchments are not shown.)  Inset maps show the location of the main map (black rectangle) in Victoria, Australia.  

Fig. 3. Runoff depth following rainfall events in study streams (A–C, E–H, J–L) and two stormwater pipes (D, I), estimated from mapped impervious areas, rainfall and specifications of stormwater control measures (x-axes) plotted against runoff depth as measured by flow gauges.  Events are coloured by season (wet, dry and shoulder).  The dotted black line shows the 1:1 relationship and the yellow dashed line shows the line of best fit for events arising from <20 mm of rain. (Events from >20 mm of rain are plotted in fainter hues)  

Fig. X.  See text in results.  Unlikely to be included in the paper.

Fig. 4. Relationships between earlier estimates of *TI* and *EI* and the corrected estimates derived in this document. A. 2001 estimates of *TI* and *EI*, B. 2005 estimates of *TI* and *AI*, C. 2009 estimates of *TI*. In each plot, the dashed line indicates the 1:1 relationship.  

Fig. 5. Time series of effective impervious variants achieved in each of the experimental catchments.  The vertical lines are at 2011-06-01, the start of the period used for comparing mapped and gauged estimates of runoff in Table 1.  

Fig. 6. Values of each *EI* variant at each site at the start of the study and the range of its increase as a result of urban growth on the y-axis, and its reduction as a result of SCM implementation in experimental sites on the x-axis.  

##### page break

```{r loadData, include = FALSE, warning=FALSE, message=FALSE}
requiredPackages <- c("RPostgreSQL","sf","lubridate","mcr","RColorBrewer",
                      "httr","rjson","scales","dplyr","here","RPostgreSQL",
                      "data.table","RMySQL")
lapply(requiredPackages, require, character.only = TRUE)
source(here("code","download.OSF.file.R"))
source(here("code","BACRIfunctions.R"))  
knitr::opts_chunk$set(echo = FALSE, dev = "png", dpi = 200)
#Check all gpkg files have been downloaded to the data file, and download any that are missing.
gpkg_files <- dir(here::here("data"))[grep("gpkg",dir(here::here("data")))]
all_gpkgs <- c("Australia_GDA94_GCS.gpkg","catIA.gpkg","cats.gpkg","ia.gpkg",
               "lsc_dbs_streams.gpkg","parcels.gpkg","scms.gpkg","siteLabels.gpkg",
               "sites.gpkg","streams.gpkg","subcs.gpkg","Victoria_GDA94_GCS.gpkg")
guids <- c("4pz5d","8rd3x","ahstz","hgeuv","yazpb","f9b2e",
           "mgh6t","s7e5r","dscqz","jm563","rneqf","ps8wy")
gpkg_files <- all_gpkgs[!all_gpkgs %in% gpkg_files]
if(length(gpkg_files) > 0){
  for(i in 1:length(gpkg_files))
   download.OSF.file(GUID = guids[i],
                     Access_Token = "https://osf.io/3um4v/?view_only=7392be708374475b98e5ebbf2f86855f",
                     file_name = gpkg_files[i], subdir = "data")
}
load(here::here("data","db_non_sf.rda"))
for(i in 1:length(all_gpkgs)){
  temp <- sf::st_read(here::here("data",paste(all_gpkgs[i],sep = "")), 
                               stringsAsFactors = FALSE, quiet = TRUE)
  temp <- st_set_geometry(st_set_geometry(temp,NULL), st_geometry(temp)) # set geometry, return sf
  assign(gsub(".gpkg","",all_gpkgs[i]),temp)
}
####
SCMs <- scms; rm(scms)
#add Little Stringybark and Dobsons impervious data to other catchments
catIA <- rbind(ia, catIA[names(catIA) != "address"])
#minor differences in sampling reaches over time and for different purposes, 
#and minor changes in catchment boundaries with some SCMs.  Select original hydrology sites for map
catMap11 <- cats[cats$hydrology == 1 & cats$origDrain == 1,]  
#Hydrology sites, pre-the Entrance, including 2 pipe sites
catMap11$col <- RColorBrewer::brewer.pal(3,"Dark2")[match(catMap11$treatment,c("R","E","C"))]
catMap11$sitecode <- substr(as.vector(catMap11$sitecode),1,7)
siteMap11 <- sites[sites$hydrology == 1,]
siteMap11$sitecode <- substr(siteMap11$sitecode,1,7)
siteMap11$col <- catMap11$col[match(siteMap11$sitecode, catMap11$sitecode)]
siteMap11$col[is.na(siteMap11$col)] <- "black"
catMap11$col[is.na(catMap11$col)] <- "black"
siteLabels$font <- 1
siteLabels$font[siteLabels$sitecode %in% as.vector(cats$sitecode[cats$core == 1])] <- 4
siteLabels <- siteLabels[!siteLabels$siteLabel %in% c("WR","HE"),]
#Fig.3 eventRainRunoff comparison...
sites <- c("BRS0015", "FER0006","LIS0001","LSS0001","LSN0001",
          "LIS0004","DBS0004","SAS0002", "LYR0007","OLN0009","DBS0008")  
#use shorter names with internally logical names for the paper
sites_p <- c("Br","Fe","L1","Ls","Ln","L4","D4","Sa","Ly","Ol","D8")
siteLabels$sites_p <- sites_p[match(siteLabels$sitecode, sites)]
```

```{r frp_v_ei, warning=FALSE, message=FALSE, fig.width = 7.48, fig.height = 3.5}
#pdf("Fig1_frp_signal.pdf", width = 7.48, height = 3.5)
layout(matrix(c(1,2,3,3), 2, 2, byrow = TRUE), heights = c(10,1), widths = c(10,10))
par(mar = c(2,4,1,1))
#data used by Walsh et al 2005 taken from "SUSE NABS issue/FRP stats/data.txt"
# and "SUSE NABS issue/EPTE/data.txt"
 lFRP50 <- c(-1.56864E+00, -2.22185E+00, -2.09691E+00, -2.22185E+00, -2.52288E+00, -1.88606E+00, -2.04576E+00, -2.52288E+00, -2.52288E+00, -2.69897E+00, -2.00000E+00, -2.39794E+00, -1.92082E+00, -1.92082E+00)
 EI <- c(1.95167E-01, 4.26416E-03, 3.62570E-02, 4.19733E-03, 0.00000E+00, 9.52280E-02, 4.63966E-01, 0.00000E+00, 0.00000E+00, 1.16397E-03, 1.03733E-02, 6.65377E-03, 3.82980E-01, 5.47130E-02)
 #jitter to reveal overlapping points - first element of multiplier is axis range
 jittery <- c(0,-0.05,0,0.05,-0.1,0,0,0,0.1,0,0,0,0,0) * 1.5 * 0.05
 jitterx <- c(0,0,0,0,-0.05,0,0,0.05,-0.05,0,0,0,0,0) * 2.6 * 0.05
 xgon <- seq(0,0.4,0.001)
 y <- -2.6 + 57*xgon
 y[y > -2] <- -2
 plot(log10(xgon +0.001),y, typ = 'n',
      xlim = c(-3,-0.39), ylim = c(-3,-1.5), axes = FALSE,
      xlab = "", ylab = "")
 yupper <- -2.3 + 490*xgon
 yupper[yupper > -1.8] <- -1.8
 ylower <- -2.8 + 13*xgon
 ylower[ylower > -2.1] <- -2.1
 polygon(c(log10(xgon +0.001),rev(log10(xgon +0.001))),
         c(yupper,rev(ylower)), col = gray(0.75), border = gray(0.75))
 lines(log10(xgon + 0.001),y)
 axis(1, at = c(-3.5,log10(c(0,0.003,0.01,0.03,0.1,0.3)+0.001)),
                labels = c("",c(0,0.003,0.01,0.03,0.1,0.3)))
 axis(2, at = log10(c(0.0001,0.001,0.003,0.01,0.03,0.1,0.3,1,3,10,30)),
      lab = c("",0.001,0.003,0.01,0.03,0.1,0.3,"1.0","3.0",10,30), las = 1)
 title(ylab = "Median FRP (mg/L)")
 points(log10(EI +0.001) + jitterx,
        lFRP50 + jittery, pch = 21, bg = gray(0.5))
 lY <- log10(EI +0.001)
 linmod <- lm(lFRP50 ~ lY)
 newdata <-  data.frame(lY = log10(c(0.0001,0.001,0.003,0.01,0.03,0.1,0.3,1,3,10,40)))
 abline(linmod, lty = 1, col = "red")
 linmodCLs <- predict(linmod, newdata, interval = "predict")
# note this tutorial says that the default interval = predict returns the 95% confidence limits.
 matplot(as.vector(newdata["lY"]),linmodCLs[,2:3], type = 'l', col = "red", lty = 3, add = TRUE)
  title(main = "a.", adj = 0)

 sigE=c(5.29000E+00, 4.32000E+00, 6.73000E+00, 5.61000E+00, 6.35000E+00, 6.79000E+00, 4.72000E+00, 4.82000E+00, 6.47000E+00, 6.42000E+00, 6.71000E+00, 6.12000E+00, 6.88000E+00, 4.00000E+00, 5.05000E+00) 
EI_sig <- c(3.87607E-02, 1.95167E-01, 4.26416E-03, 3.62570E-02, 4.19733E-03, 0.00000E+00, 9.52280E-02, 4.63966E-01, 0.00000E+00, 0.00000E+00, 1.16397E-03, 1.03733E-02, 6.65377E-03, 3.82980E-01, 5.47130E-02)
 
 plot(log10(EI_sig +0.001),sigE, typ = 'n',
      xlim = c(-3,-0.39), ylim = c(3,8), axes = FALSE,
      xlab = "", ylab = "")
 axis(1, at = c(-3.5,log10(c(0,0.003,0.01,0.03,0.1,0.3)+0.001)),
                labels = c("",c(0,0.003,0.01,0.03,0.1,0.3)))
 axis(2, at = 1:9, las = 1)
 title(ylab = "SIGNAL score")

 y <- 6.7 - 31*xgon
 y[y < 4.5] <- 4.5
 yupper <- 6.9 - 21*xgon
 yupper[yupper < 4.7] <- 4.7
 ylower <- 6.5 - 40*xgon
 ylower[ylower < 4.2] <- 4.2
 polygon(c(log10(xgon +0.001),rev(log10(xgon +0.001))),
         c(yupper,rev(ylower)), col = gray(0.75), border = gray(0.75))
 lines(log10(xgon + 0.001),y)
 
 points(log10(EI_sig +0.001),
        sigE, pch = 21, bg = gray(0.5))
 lY <- log10(EI_sig +0.001)
 linmod <- lm(sigE ~ lY)
 newdata <-  data.frame(lY = log10(c(0.0001,0.001,0.003,0.01,0.03,0.1,0.3,1,3,10,40)))
 abline(linmod, lty = 1, col = "red")
 linmodCLs <- predict(linmod, newdata, interval = "predict")
 matplot(as.vector(newdata["lY"]),linmodCLs[,2:3], type = 'l', col = "red", lty = 3, add = TRUE)
 title(main = "b.", adj = 0)
 par(mar = c(0,0,0,0))
 plot.new()
  title(xlab = "             Proportion effective imperviousness", line = -1)

# dev.off()
 
```
  
Fig. 1. 

```{r sitemap, warning=FALSE, message=FALSE, fig.width = 7.48, fig.height = 9.62}
dpi <- 300
#png("images/fig_sitemap.png",res = dpi, width = 7.48*dpi, height = 9.62*dpi)
lo <- layout(matrix(c(1,2,1,3,1,4,1,5,1,6),5,2,byrow=TRUE),widths = c(5.75,1.25), 
       heights = c(1.25,1.25,4,1.25,1.25))
par(mar = c(0,0,0,0))
plot(catMap11$geometry, lty = 3, lwd = 0.5, border = "white")
#censored to exclude IA newer than October 2009 (i.e. 2009 IA)
plot(catIA$geometry[is.na(catIA$constructionDate) |
             (!is.na(catIA$constructionDate) &
                catIA$constructionDate < "2009-10-01")],
     col = c(gray(0.6),gray(0.85),gray(0.85))[match(catIA$conn,c(1,0,0.5))],
     border = c(gray(0.6),gray(0.85),gray(0.85))[match(catIA$conn,c(1,0,0.5))],
     lwd = 0.5, add = TRUE)
#col converts conn = 0.5 to 0 (those surfaces that would be connected if the pits weren't full)..
#only really applies in Wicks
plot(streams$geometry, col = "dodgerblue", lwd = 2, add = TRUE)
plot(catMap11$geometry, lty = 3, lwd = 2, border = catMap11$col, add = TRUE)
plot(siteMap11$geometry, pch = 21, bg = siteMap11$col, cex = 1.1, add = TRUE)
siteLabels$font[siteLabels$font == 1] <- 2 #make both normal and italic fonts bold
text(st_coordinates(siteLabels),siteLabels$sites_p, cex = 1, font = siteLabels$font)
arrows(st_coordinates(siteLabels)[siteLabels$siteLabel == "LS"][1]-200,
       st_coordinates(siteLabels)[siteLabels$siteLabel == "LS"][2],
       st_coordinates(siteMap11)[siteMap11$sitecode == "LSS0001"][1],
       st_coordinates(siteMap11)[siteMap11$sitecode == "LSS0001"][2], length = 0.05)
arrows(st_coordinates(siteLabels)[siteLabels$siteLabel == "LM"][1],
       st_coordinates(siteLabels)[siteLabels$siteLabel == "LM"][2]+100,
       st_coordinates(siteMap11)[siteMap11$sitecode == "LIS0001"][1],
       st_coordinates(siteMap11)[siteMap11$sitecode == "LIS0001"][2], length = 0.05)
arrows(st_coordinates(siteLabels)[siteLabels$siteLabel == "LN"][1],
       st_coordinates(siteLabels)[siteLabels$siteLabel == "LN"][2]-100,
       st_coordinates(siteMap11)[siteMap11$sitecode == "LSN0001"][1],
       st_coordinates(siteMap11)[siteMap11$sitecode == "LSN0001"][2], length = 0.05)
raster::scalebar(2000, xy = c(355500,5801500), label= "2 km")
rng <- par("usr")
rngdat <- data.frame(x1 = rng[1], x2 = rng[2], y1 = rng[3], y2 = rng[4])
box()
plot.new()
legend("center", lty = c(3,3,3), lwd = c(2,2,2), 
       col = c(RColorBrewer::brewer.pal(3,"Dark2")), title = "Catchments",
       legend = c("Control","Experimental","Reference"), text.col = "white")
legend("center", pch = 21, pt.bg = c(RColorBrewer::brewer.pal(3,"Dark2")),
       title = "Catchments",
       legend = c("Reference","Experimental","Control"), bty = 'n')
plot.new()
legend("center", 
       pch = 15, pt.cex = 1., col = c(gray(0.6),gray(0.85)),
       legend = c("Connected","Unconnected"), title = "Impervious areas")
rngPoly <- st_sfc(st_polygon(list(rbind(rng[c(1,3)], rng[c(1,4)], rng[c(2,4)], 
                                 rng[c(2,3)],rng[c(1,3)]))))
rngPoly <- st_sf(a = 1, geom = rngPoly)
st_crs(rngPoly) <- 28355
rngPoly <- rngPoly %>% st_transform(4283)
plot.new()
plot(Australia_GDA94_GCS$geometry)
plot(Victoria_GDA94_GCS$geometry, col = "white", add = TRUE)
polygon(c(143.5,146.5,146.5,143.5),c(-36.5,-36.5,-39.1,-39.1), col = scales::alpha(gray(0.5),0.5))
plot(rngPoly$geom, col = "black", add = TRUE)
title(main = "Australia", adj = 0, font.main = 1, line = -1)
box()
par(mar =c(0,0,0,0))
bounds <- st_sfc(st_point(c(143.5,-36.5)), st_point(c(146.5,-39.1)),crs=4283)
plot(bounds, col = "white")
plot(Victoria_GDA94_GCS$geometry, add = TRUE)
plot(rngPoly$geom, col = scales::alpha(gray(0.5),0.5), add = TRUE)
title(main = "Central Victoria ", adj = 1, font.main = 1, line = -1)
box()
#dev.off()
```
  
Fig. 2.  

```{r EITIcomparisons, echo = FALSE, warning=FALSE, message=FALSE, fig.width = 7, fig.height = 3}
# #JKia was derived in ArcGIS by creating 
# #a) LIS_BACRIsubcats.shp (using the clip function in Editing to remove overlapping catchments from LIS_BACRIcats.shp so that the IDENTITY function doesn't create multiple copies of each polygon where cats overlap). Note that in this subcat layer, I renamed the ecological LIS0001 site LIS0001E.
# #b) LIS_BACRIia_JK2009.shp (using the IDENTITY tool to cut each impervious polygon on LIS_BACRIsubcats and give it the cat attributes of the subcat it lies in)
# #pdf("Fig5.pdf",height = 3, width = 7)
# JKia <- sf::st_read("data/ESRI/LIS_BACRIia_JK.shp")
# JKia$cat <- as.vector(JKia$cat)
# 
# EIstats <- data.frame(site = c("LIS0004","LIS0004H","LIS0001","LSS0001","LSN0001","DBS0004",
#                                "DBS0008", "SAS0002","LYR0007","OLN0009","BRS0015","FER0006"),
#                       stringsAsFactors = FALSE)
# JKia$area_m2 <- sf::st_area(JKia)
# JKtia <- aggregate(as.numeric(JKia$area_m2), by = list(cat = JKia$cat), FUN = sum)
# JKtia$x[JKtia$cat == "DBS0008"] <- sum(JKtia$x[JKtia$cat %in% c("DBS0008","DBS0004")])
# JKtia$x[JKtia$cat == "LIS0004"] <- sum(JKtia$x[JKtia$cat %in% c("LIS0004","LIS0001","LIS0001E","LSN0001","LSS0001")])
# JKtia$x[JKtia$cat == "LIS0004H"] <- sum(JKtia$x[JKtia$cat %in% c("LIS0004","LIS0004H")])
# JKtia$carea <- as.numeric(catMap$carea_m2[match(JKtia$cat, catMap$cat)])
# JKtia$ti <- JKtia$x/JKtia$carea
# 
# #Original TI and EI estimates from 2000-2001 (extracted from table in Hatt et al 2004)
# d210Stats <- as.data.frame(readxl::read_excel("data/D210siteStats.xlsx", skip = 1))
# EIstats$TI2001 <- d210Stats$TI[match(EIstats$site,d210Stats$Sitecode)]
# EIstats$EI2001 <- d210Stats$EI[match(EIstats$site,d210Stats$Sitecode)]
#   
# #Now the 2001 estimates for LIS0004 were for the site further downstream at Connie's place (now called LIS0005).  Here I adjust those estimates for LIS0004 and LIS0004H by catchment area.
# L5addCarea <- d210Stats$area_ha[!is.na(d210Stats$Sitecode) & d210Stats$Sitecode == "LIS0004H"]*10000 - as.numeric(catMap$carea_m2[catMap$cat == "LIS0004H"]) #difference in catchment area between D210 LIS0004 carea and estimate at LIS0004H
# L5addTIA <- 1000 #two additional houses in the addition carea (neither connected)
# EIstats[EIstats$site == "LIS0004",c("TI2001", "EI2001")] <- EIstats[EIstats$site == "LIS0004H",c("TI2001", "EI2001")]
# LIS0005EarlyEsts <- EIstats[EIstats$site == "LIS0004",-1]
# EIstats[EIstats$site == "LIS0004",-1] <- 
#   ((LIS0005EarlyEsts*as.numeric(catMap$carea_m2[catMap$cat == "LIS0004H"]) + L5addCarea) +
#      c(L5addTIA, 0))/as.numeric(catMap$carea_m2[catMap$cat == "LIS0004"])
# EIstats[EIstats$site == "LIS0004H",-1] <- 
#   ((LIS0005EarlyEsts*as.numeric(catMap$carea_m2[catMap$cat == "LIS0004H"]) + L5addCarea) +
#      c(L5addTIA, 0))/as.numeric(catMap$carea_m2[catMap$cat == "LIS0004H"])
# 
# #2004 estimates of TI and AI
# # wkStats <- read.csv(paste(LSCdir,"/experimentalData/EMel bugsites in fech (from Walsh and Kunapo 2009).csv",sep=""),
# #                     stringsAsFactors = FALSE)
# # EIstats$TI2005 <- wkStats$TI[match(EIstats$site,wkStats$sitecode)]
# # EIstats$EI2005 <- wkStats$EI[match(EIstats$site,wkStats$sitecode)]
# #In theory the same data, but used by Walsh and Webb 2016...
# #(dbf file copied from shapefile in wergSpatial/MWregion/vectors/catchments/DCI2006)
# wwStats <- foreign::read.dbf("data/MWregion_subcs_150411.dbf")
# sitesDB <- read.csv("data/DBsubcs.csv")
# wwStats <- wwStats[wwStats$SITE %in% sitesDB$subc,]
# wwStats$sitecode <- sitesDB$sitecode[match(wwStats$SITE,sitesDB$subc)]
# EIstats$TI2005 <- wwStats$TI[match(EIstats$site,wwStats$sitecode)]
# EIstats$EI2005 <- wwStats$DAI9[match(EIstats$site,wwStats$sitecode)]
# 
# EIstats$JKti <- JKtia$ti[match(EIstats$site, JKtia$cat)]
# 
# EIstats$group <- c(rep("r",3),rep("c",2),rep("e",7))[match(EIstats$site, c("SAS0002","LYR0007","OLN0009","BRS0015","FER0006",
#                                                                            "LIS0004", "LIS0004H", "LIS0001", "LSS0001", 
#                                                                            "LSN0001", "DBS0004", "DBS0008"))]
# EIstats$col <- RColorBrewer::brewer.pal(3,"Dark2")[match(EIstats$group,c("c","e","r"))]
# EIstats$lty <- 1
# EIstats$lty[EIstats$site %in% c("LIS0001", "LSS0001","LSN0001","DBS0008")] <- 2
# 
# load("compiled_R_objects/treatSeq.rda")
# temp <- treatSeq[treatSeq$date == lubridate::ymd('2001-06-01',tz = "UTC"),]
# EIstats$ti2001Correct <- temp$ti[match(EIstats$site, temp$site)]
# EIstats$ei2001Correct <- temp$ei[match(EIstats$site, temp$site)]
# temp <- treatSeq[treatSeq$date == lubridate::ymd('2004-12-01',tz = "UTC"),]
# EIstats$ti2005Correct <- temp$ti[match(EIstats$site, temp$site)]
# EIstats$ei2005Correct <- temp$ei[match(EIstats$site, temp$site)]
# temp <- treatSeq[treatSeq$date == lubridate::ymd('2009-10-17',tz = "UTC"),]
# EIstats$ti2009Correct <- temp$ti[match(EIstats$site, temp$site)]
# EIstats$ei2009Correct <- temp$ei[match(EIstats$site, temp$site)]
# 
# par(mfrow= c(1,3))
#  plot(log10(EIstats$ti2001Correct + 0.001),log10(EIstats$TI2001 + 0.001), axes = FALSE, 
#       xlab = "New estimate of 2001 imperviousness (%)", 
#       ylab = "2001 imperviousness estimate (%)", xlim = log10(c(0,0.30)+0.001), ylim = log10(c(0,0.30)+0.001))
#  points(log10(EIstats$ei2001Correct + 0.001),log10(EIstats$EI2001 + 0.001), pch = 6)
#  axis(1, at = c(-4,log10(c(0,0.001,0.003,0.01,0.03,0.1,0.3) + 0.001)), labels = c("",c(0,0.001,0.003,0.01,0.03,0.1,0.3)*100))
#  axis(2, at = c(-4,log10(c(0,0.001,0.003,0.01,0.03,0.1,0.3) + 0.001)), labels = c("",c(0,0.001,0.003,0.01,0.03,0.1,0.3)*100), las = 1)
#  abline(0,1,lty = 3)
#  legend("bottomright",pch = c(1,6), legend = c("TI","EI"))
#  title(main = " A.", adj = 0, line = -1, font.main = 1)
# # identify(EIstats$ti2001Correct, EIstats$TI2001,EIstats$site)
# #  identify(EIstats$ei2001Correct, EIstats$EI2001,EIstats$site)
# 
#  plot(log10(EIstats$ti2005Correct + 0.001),log10(EIstats$TI2005 + 0.001), axes = FALSE, 
#       xlab = "New estimate of 2005 imperviousness (%)", 
#       ylab = "2005 imperviousness estimate (%)", xlim = log10(c(0,0.30)+0.001), ylim = log10(c(0,0.30)+0.001))
#  points(log10(EIstats$ei2005Correct + 0.001), log10(EIstats$EI2005 + 0.001), pch = 6)
#  axis(1, at = c(-4,log10(c(0,0.001,0.003,0.01,0.03,0.1,0.3) + 0.001)), labels = c("",c(0,0.001,0.003,0.01,0.03,0.1,0.3)*100))
#  axis(2, at = c(-4,log10(c(0,0.001,0.003,0.01,0.03,0.1,0.3) + 0.001)), labels = c("",c(0,0.001,0.003,0.01,0.03,0.1,0.3)*100), las = 1)
#   abline(0,1,lty = 3)
#  title(main = " B.", adj = 0, line = -1, font.main = 1)
# #identify(EIstats$ti2005Correct, EIstats$TI2006,EIstats$site)
# #identify(EIstats$ei2005Correct, EIstats$EI2006,EIstats$site)
# 
# plot(log10(EIstats$ti2009Correct + 0.001),log10(as.numeric(EIstats$JKti) + 0.001), axes = FALSE, 
#       xlab = "New estimate of 2009 imperviousness (%)", 
#       ylab = "2009 imperviousness estimate (%)", xlim = log10(c(0,0.30)+0.001), ylim = log10(c(0,0.30)+0.001))
#  axis(1, at = c(-4,log10(c(0,0.001,0.003,0.01,0.03,0.1,0.3) + 0.001)), labels = c("",c(0,0.001,0.003,0.01,0.03,0.1,0.3)*100))
#  axis(2, at = c(-4,log10(c(0,0.001,0.003,0.01,0.03,0.1,0.3) + 0.001)), labels = c("",c(0,0.001,0.003,0.01,0.03,0.1,0.3)*100), las = 1)
#  abline(0,1,lty = 3)
#  title(main = " C.", adj = 0, line = -1, font.main = 1)
# #identify(EIstats$ti2005Correct, EIstats$TI2006,EIstats$site)
# #identify(EIstats$ei2005Correct, EIstats$EI2006,EIstats$site)
# #identify(EIstats$ti2009Correct, EIstats$JKti,EIstats$site)
# #dev.off()
```
Fig. 3  

```{r MonitoringSiteTrendsA, results="hide", warning = FALSE, echo = FALSE, fig.width = 7, fig.height = 9, fig.cap = "Time series of effective impervious variants achieved in each of the four LSC catchments."}
load(here::here("compiled_objects","ei_ts.rda"))
layout(matrix(c(1,2,3,1,4,5,1,6,7,0,8,8),4,3,byrow = TRUE),heights= c(10,10,10,1),widths = c(1,10,10))
par(mar = c(0,0,0,0))
plot.new()
title(ylab = expression(paste("Effective imperviousness variant (%)"), sep = ""), line = -1.5)
par(mar = c(2,3,1,1))
plotlEItrends(ei_101$iats)
abline(v=lubridate::ymd("2011-01-01")) #date of divergence across all sites...
title(main = "A. DBS0004", adj = 0, font.main = 1, cex.main = 0.9)
plotlEItrends(ei_103$iats)
abline(v=lubridate::ymd("2011-01-01"))
title(main = "B. DBS0008", adj = 0, font.main = 1, cex.main = 0.9)
plotlEItrends(ei_53$iats)
abline(v=lubridate::ymd("2011-01-01"))
title(main = "C. LSN0001", adj = 0, font.main = 1, cex.main = 0.9)
plotlEItrends(ei_74$iats)
abline(v=lubridate::ymd("2011-01-01"))
title(main = "D. LIS0001", adj = 0, font.main = 1, cex.main = 0.9)
legend("bottomright",legend = c("EI",expression(EI[sEB]),expression(EI[sVR]),expression(EI[sRO]),expression(EI[sFV]),expression(EI[s])),
       lty = c(2,1,1,1,1,3), col = c("black","black","green","red","orange","blue"), lwd = c(2,1,1,1,1,1))
plotlEItrends(ei_36$iats)
abline(v=lubridate::ymd("2011-01-01"))
title(main = "E. LSS0001", adj = 0, font.main = 1, cex.main = 0.9)
plotlEItrends(ei_71$iats)
abline(v=lubridate::ymd("2011-01-01"))
title(main = "F. LIS0004 (at gauge)", adj = 0, font.main = 1, cex.main = 0.9)
par(mar = c(0,0,0,0))
plot.new()
title(xlab = "Date", line = -1.5)
```
  
Fig. 4.  
```{r EIranges, echo = FALSE, warning=FALSE, message=FALSE,fig.width=5,fig.height=7}
# #pdf("Fig5.pdf",width = 5, height = 7)
# sites <-as.vector(catMap11$sitecode)
# sitecols <- as.vector(catMap11$col)
# x <- data.frame(site = rep(as.vector(sites), each = 7), 
#                 EIvar = rep(c("ti","ei","scmei","eb","ro","vr","fv"),11),
#                 col = rep(as.vector(sitecols),each = 7),
#                 start = NA,
#                 max = NA,
#                 fin = NA, stringsAsFactors = FALSE)
# for(i in 1:length(sites)){
#   x$start[x$site == sites[i]] <- t(treatSeq[treatSeq$site == sites[i],c("ti","ei","s","eb","ro","vr","fv")][1,])
#   x$max[x$site == sites[i]] <- t(apply(treatSeq[treatSeq$site == sites[i],c("ti","ei","s","eb","ro","vr","fv")],2,max))
#   x$fin[x$site == sites[i]] <- t(tail(treatSeq[treatSeq$site == sites[i],c("ti","ei","s","eb","ro","vr","fv")],1))
# }
# lo <- layout(matrix(c(7,1,2,7,3,4,7,5,6,0,8,8), 4,3,byrow = TRUE), widths = c(1,8,8), heights = c(8,8,8,1))
# #layout.show(lo)
# eivars <- c("scmei","eb","ro","vr","fv")
# for(a in 1:length(eivars)){
#   par(mar = c(2,2,1,1))
# plot(1,1,xlim = range(log10(x[-(1:3)] + 0.001)),ylim = range(log10(x[-(1:3)] + 0.001)),type = 'n', axes = FALSE,
#      xlab = "",ylab = "")
# points(log10(x$start[x$EIvar == eivars[a]] + 0.001),log10(x$start[x$EIvar == eivars[a]] + 0.001),pch = 21, 
#        bg = x$col[x$EIvar == eivars[a]])
# for(i in 1:length(sites)){
#   arrows(log10(x$start[x$EIvar == eivars[a] & x$site == sites[i]] + 0.001),
#          log10(x$start[x$EIvar == eivars[a] & x$site == sites[i]] + 0.001),
#          log10(x$start[x$EIvar == eivars[a] & x$site == sites[i]] + 0.001),
#          log10(x$max[x$EIvar == eivars[a] & x$site == sites[i]] + 0.001),
#          length = 0.05, col = x$col[x$site == sites[i]][1])
#   if(x$fin[x$EIvar == eivars[a] & x$site == sites[i]] < x$start[x$EIvar == eivars[a] & x$site == sites[i]])
#   arrows(log10(x$start[x$EIvar == eivars[a] & x$site == sites[i]] + 0.001),
#          log10(x$start[x$EIvar == eivars[a] & x$site == sites[i]] + 0.001),
#          log10(x$fin[x$EIvar == eivars[a] & x$site == sites[i]] + 0.001),
#          log10(x$start[x$EIvar == eivars[a] & x$site == sites[i]] + 0.001),
#          length = 0.05, col = x$col[x$site == sites[i]][1])
# }
# if(a %in% c(1,3,5)){
# axis(2,at = log10(c(0,0.1,0.3,1,3,10,30)/100 + 0.001), labels = c(0,0.1,0.3,1,3,10,30),las =1 )
# }else{
# axis(2,at = log10(c(0,0.1,0.3,1,3,10,30)/100 + 0.001), labels = rep("",length(c(0,0.1,0.3,1,3,10,30))),las =1 )  
# }
# if(a > 3){
# axis(1,at = log10(c(0,0.1,0.3,1,3,10,30)/100 + 0.001), labels = c(0,0.1,0.3,1,3,10,30),las =1 )
# }else{
# axis(1,at = log10(c(0,0.1,0.3,1,3,10,30)/100 + 0.001), labels = rep("",length(c(0,0.1,0.3,1,3,10,30))),las =1 )
# }
# title(main = paste(LETTERS[a], ".", eivars[a]), adj = 0)
# }
# plot.new()
# legend("center",legend = c("Reference","Experimental","Control"),pch = 21,
#        pt.bg = c(catMap11$col[catMap11$FIRST_type== "reference"][1],
#                  catMap11$col[grep("Exp",catMap11$FIRST_type)][1],
#                  catMap11$col[catMap11$FIRST_type== "control"][1]))
# par(mar = c(0,0,0,0))
# plot.new()
# title(ylab = "EI variant: urban growth trajectory", line = -2)
# plot.new()
# title(xlab = "EI variant: restoration trajectory", line = -1.5)
# #dev.off()
```
